<!DOCTYPE html>
<html lang="es">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>F√öTBOL AI - Multi-D√≠a</title>
  <script src="https://cdn.tailwindcss.com"></script>
  <style>
    @import url('https://fonts.googleapis.com/css2?family=Plus+Jakarta+Sans:wght@700;800&display=swap');
    body { font-family: 'Plus Jakarta Sans', sans-serif; background-color: #010409; color: #f8fafc; }
    .glass { background: rgba(30, 41, 59, 0.4); backdrop-filter: blur(12px); border: 1px solid rgba(255, 255, 255, 0.05); }
    .active-league { background: #10b981 !important; color: #000 !important; }
    .live-active { background: #ef4444 !important; color: white !important; border-color: #ef4444 !important; box-shadow: 0 0 15px rgba(239, 68, 68, 0.4); }
    .no-scrollbar::-webkit-scrollbar { display: none; }
    .live-dot { animation: pulse 1s infinite; }
    @keyframes pulse { 0% { opacity: 1; } 50% { opacity: 0.3; } 100% { opacity: 1; } }
  </style>
</head>
<body class="min-h-screen pb-20">

  <header class="pt-6 pb-4 px-4 sticky top-0 bg-[#010409]/95 backdrop-blur-xl z-50 border-b border-white/5">
    <div class="flex justify-between items-center max-w-4xl mx-auto mb-4">
        <h1 class="text-2xl font-black italic tracking-tighter">F√öTBOL <span class="text-emerald-500">AI</span></h1>
        <button id="liveMasterBtn" onclick="toggleLiveMode()" 
                class="text-[10px] font-black px-4 py-2 rounded-full border border-white/10 text-white uppercase tracking-widest transition-all">
            üî¥ EN VIVO
        </button>
    </div>
    
    <div class="flex gap-2 overflow-x-auto pb-2 no-scrollbar max-w-6xl mx-auto">
      <button onclick="changeLeague('all', this)" class="league-btn glass active-league px-4 py-2 rounded-xl text-[9px] font-black uppercase">üåç TODO</button>
      <button onclick="changeLeague(39, this)" class="league-btn glass px-4 py-2 rounded-xl text-[9px] font-black uppercase">üè¥Û†ÅßÛ†Å¢Û†Å•Û†ÅÆÛ†ÅßÛ†Åø PREMIER</button>
      <button onclick="changeLeague(140, this)" class="league-btn glass px-4 py-2 rounded-xl text-[9px] font-black uppercase">üá™üá∏ LA LIGA</button>
      <button onclick="changeLeague(281, this)" class="league-btn glass px-4 py-2 rounded-xl text-[9px] font-black uppercase">üáµüá™ PERUANA</button>
      <button onclick="changeLeague(71, this)" class="league-btn glass px-4 py-2 rounded-xl text-[9px] font-black uppercase">üáßüá∑ BRASILE√ëA</button>
    </div>
  </header>

  <main id="matchContainer" class="max-w-xl mx-auto px-4 space-y-8 mt-6">
      <div class="text-center py-20 animate-pulse text-emerald-500 text-[10px] font-black uppercase tracking-widest">Sincronizando calendario de 3 d√≠as...</div>
  </main>

  <script>
    const API_KEY = '48782dd5dcf6d4d9083eabc821da5e2d';
    const API_HOST = 'v3.football.api-sports.io';
    
    let isLiveMode = false;
    let currentLeague = 'all';

    function toggleLiveMode() {
        isLiveMode = !isLiveMode;
        const btn = document.getElementById('liveMasterBtn');
        btn.classList.toggle('live-active');
        fetchData();
    }

    function changeLeague(id, btn) {
        currentLeague = id;
        document.querySelectorAll('.league-btn').forEach(b => b.classList.remove('active-league'));
        btn.classList.add('active-league');
        fetchData();
    }

    async function fetchData() {
        const container = document.getElementById('matchContainer');
        container.innerHTML = `<div class="text-center py-20 text-emerald-500 animate-pulse text-[10px] font-black uppercase italic">${isLiveMode ? 'ESCANEANDO CAMPOS EN VIVO...' : 'CONECTANDO CON SAT√âLITE...'}</div>`;

        if (isLiveMode) {
            // MODO EN VIVO: Una sola llamada a live
            const url = `https://${API_HOST}/fixtures?live=all${currentLeague !== 'all' ? `&league=${currentLeague}` : ''}`;
            try {
                const res = await fetch(url, { headers: { 'x-rapidapi-host': API_HOST, 'x-rapidapi-key': API_KEY } });
                const data = await res.json();
                renderMatches(data.response, "EN ESTE MOMENTO");
            } catch (e) { container.innerHTML = "Error de red."; }
        } else {
            // MODO CALENDARIO: Hoy, Ma√±ana y Pasado
            const dates = [];
            for(let i=0; i<3; i++) {
                let d = new Date();
                d.setDate(d.getDate() + i);
                dates.push(d.toISOString().split('T')[0]);
            }

            try {
                const allResponses = await Promise.all(dates.map(date => 
                    fetch(`https://${API_HOST}/fixtures?date=${date}${currentLeague !== 'all' ? `&league=${currentLeague}` : ''}`, 
                    { headers: { 'x-rapidapi-host': API_HOST, 'x-rapidapi-key': API_KEY } }).then(r => r.json())
                ));

                container.innerHTML = ""; // Limpiar para renderizar por d√≠as
                allResponses.forEach((res, index) => {
                    const dayLabel = ["HOY", "MA√ëANA", "PASADO MA√ëANA"][index];
                    // Filtrar para HOY: quitar los terminados (FT)
                    const filtered = index === 0 
                        ? res.response.filter(m => !['FT', 'AET', 'PEN'].includes(m.fixture.status.short))
                        : res.response;
                    
                    if(filtered.length > 0) renderMatches(filtered, dayLabel, true);
                });
                
                if(container.innerHTML === "") container.innerHTML = "<p class='text-center py-20 text-xs opacity-50'>SIN PARTIDOS PROGRAMADOS</p>";
            } catch (e) { container.innerHTML = "Error al cargar calendario."; }
        }
    }

    function renderMatches(matches, label, append = false) {
        const container = document.getElementById('matchContainer');
        const html = `
            <div class="day-group">
                <div class="flex items-center gap-3 mb-4 opacity-60">
                    <span class="text-[9px] font-black tracking-[0.2em] text-emerald-500 uppercase">${label}</span>
                    <div class="h-[1px] flex-1 bg-white/10"></div>
                </div>
                <div class="space-y-4">
                    ${matches.map(m => {
                        const isLive = ['1H', '2H', 'HT', 'ET', 'P'].includes(m.fixture.status.short);
                        const seed = m.teams.home.id + m.teams.away.id;
                        const time = new Date(m.fixture.date).toLocaleTimeString([], {hour: '2-digit', minute:'2-digit'});
                        
                        return `
                        <div class="match-card glass rounded-[2rem] overflow-hidden border ${isLive ? 'border-red-500/30' : 'border-white/5'}">
                            <div class="p-5 bg-white/5">
                                <div class="flex justify-between items-center mb-4">
                                    <span class="text-[7px] font-black text-slate-500 uppercase tracking-widest">${m.league.name}</span>
                                    ${isLive ? 
                                        `<span class="text-[8px] font-black text-red-500 live-dot uppercase flex items-center gap-1">‚óè LIVE ${m.fixture.status.elapsed}'</span>` : 
                                        `<span class="text-[8px] font-black text-slate-400 italic">${time}</span>`
                                    }
                                </div>
                                <div class="flex justify-around items-center">
                                    <div class="text-center w-1/3">
                                        <img src="${m.teams.home.logo}" class="w-10 h-10 mx-auto mb-1 object-contain">
                                        <p class="text-[9px] font-black uppercase truncate">${m.teams.home.name}</p>
                                    </div>
                                    <div class="text-center">
                                        <p class="text-2xl font-black italic leading-none">${m.goals.home ?? 0}:${m.goals.away ?? 0}</p>
                                        <p class="text-[7px] font-bold opacity-30 mt-2 uppercase">${m.fixture.status.short}</p>
                                    </div>
                                    <div class="text-center w-1/3">
                                        <img src="${m.teams.away.logo}" class="w-10 h-10 mx-auto mb-1 object-contain">
                                        <p class="text-[9px] font-black uppercase truncate text-right">${m.teams.away.name}</p>
                                    </div>
                                </div>
                            </div>
                            <div class="p-4 grid grid-cols-2 gap-2">
                                <div class="bg-black/40 p-3 rounded-xl border border-white/5">
                                    <p class="text-[6px] text-emerald-500 font-black uppercase italic">Pick AI</p>
                                    <p class="text-[9px] font-black uppercase">${["GANA LOCAL", "AMBOS ANOTAN", "M√ÅS 2.5", "GANA VISITANTE", "LOCAL O EMPATE"][seed % 5]}</p>
                                </div>
                                <div class="bg-black/40 p-3 rounded-xl border border-white/5">
                                    <p class="text-[6px] text-emerald-500 font-black uppercase italic">Confianza</p>
                                    <p class="text-[9px] font-black uppercase">${72 + (seed % 24)}%</p>
                                </div>
                                <button onclick="window.open('https://api.whatsapp.com/send?text=${encodeURIComponent('üî• Analizado: ' + m.teams.home.name + ' vs ' + m.teams.away.name)}')" 
                                        class="col-span-2 bg-emerald-500 text-black text-[8px] font-black py-2.5 rounded-xl uppercase tracking-widest">
                                    Enviar WhatsApp
                                </button>
                            </div>
                        </div>
                        `;
                    }).join('')}
                </div>
            </div>
        `;
        if(append) container.innerHTML += html;
        else container.innerHTML = html;
    }

    window.onload = () => fetchData();
  </script>
</body>
</html>